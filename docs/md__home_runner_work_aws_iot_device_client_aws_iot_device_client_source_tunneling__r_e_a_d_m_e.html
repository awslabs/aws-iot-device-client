<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AWS IoT Device Client: Secure Tunneling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AWS IoT Device Client
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Secure Tunneling </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Notice:</b> Running the AWS IoT Device Client will incur usage of AWS IoT services, and is likely to incur charges on your AWS account. Please refer the pricing pages for <a href="https://aws.amazon.com/iot-core/pricing/">AWS IoT Core</a>, <a href="https://aws.amazon.com/iot-device-management/pricing/">AWS IoT Device Management</a>, and <a href="https://aws.amazon.com/iot-device-defender/pricing/">AWS IoT Device Defender</a> for more details.</p>
<ul>
<li><a href="#secure-tunneling-feature">Secure Tunneling Feature</a><ul>
<li><a href="#secure-tunneling-feature-configuration-options">Secure Tunneling Feature Configuration Options</a><ul>
<li><a href="#configuring-the-secure-tunneling-feature-via-the-command-line">Configuring the Secure Tunneling feature via the command line</a></li>
<li><a href="#configuring-the-secure-tunneling-feature-via-the-json-configuration-file">Configuring the Secure Tunneling feature via the JSON configuration file</a></li>
</ul>
</li>
<li><a href="#example-steps-to-use-the-secure-tunneling-feature">Example steps to use the Secure Tunneling feature</a></li>
<li><a href="#policy-permissions">Policy Permissions</a></li>
<li><a href="#limitation">Limitation</a></li>
</ul>
</li>
</ul>
<p>*Back To The Main Readme*</p>
<h1><a class="anchor" id="autotoc_md75"></a>
Secure Tunneling Feature</h1>
<p>The Secure Tunneling feature allows you to gain access to a remote device even if the device is behind a firewall. You may want to remote access to a device to troubleshoot, or update its configuration. For complete reference of Secure Tunneling, please see <a href="https://docs.aws.amazon.com/iot/latest/developerguide/secure-tunneling.html">here</a>.</p>
<p>Without the Device Client, if you wanted secure privileged access to a device by secure tunneling, you would need to build and deploy a compatible binary of <a href="https://docs.aws.amazon.com/iot/latest/developerguide/local-proxy.html">local proxy</a> onto the device. You'd also need to write, build and deploy <a href="https://docs.aws.amazon.com/iot/latest/developerguide/agent-snippet.html">code</a> that subscribes to the MQTT new tunnel topic and launches the local proxy. When you use the Device Client, you can skip building the local proxy for your IoT device and writing code to subscribe to the relevant MQTT topics. You can simply build and deploy the Device Client to your IoT devices and enable the Secure Tunneling feature.</p>
<h2><a class="anchor" id="autotoc_md76"></a>
Secure Tunneling Feature Configuration Options</h2>
<p>You can enable or disable the Secure Tunneling feature by a CLI argument or in the configuration file.</p>
<p><code>enabled</code>: Whether or not the Secure Tunneling feature is enabled (True/False). If not specified, Secure Tunneling feature is enabled by default.</p>
<h3><a class="anchor" id="autotoc_md77"></a>
Configuring the Secure Tunneling feature via the command line</h3>
<div class="fragment"><div class="line">$ ./aws-iot-device-client --enable-tunneling [true|false]</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md78"></a>
Configuring the Secure Tunneling feature via the JSON configuration file</h3>
<div class="fragment"><div class="line">{</div>
<div class="line">  ...</div>
<div class="line">  &quot;tunneling&quot;: {</div>
<div class="line">    &quot;enabled&quot;: [true|false]</div>
<div class="line">  }</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md79"></a>
Example steps to use the Secure Tunneling feature</h2>
<p>Here is a sample workflow to access a remote device using the Secure Tunneling feature.</p>
<p>On the remote device:</p><ol type="1">
<li>Deploy and run the Device Client with Secure Tunneling feature enabled</li>
</ol>
<p>On your laptop:</p><ol type="1">
<li>Create a new secure tunnel on the AWS Console</li>
<li>Copy the source access token</li>
<li>Start the <a href="https://github.com/aws-samples/aws-iot-securetunneling-localproxy/blob/master/README.md#options-set-via-command-line-arguments">local proxy</a> with the source access token. For example: <br  />
 <div class="fragment"><div class="line">$ ./localproxy -r us-east-1 -s 8080 -t &lt;source token&gt;</div>
</div><!-- fragment --></li>
<li>Start the SSH client but connect to the local proxy listening port. For example: <div class="fragment"><div class="line">$ ssh -p 8080 &lt;remote_user_name&gt;@localhost</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md80"></a>
Policy Permissions</h2>
<p>In order to use the Secure Tunneling feature the device must first have permission to connect to IoT Core. The device must also be able to subscribe to and receive messages on the Secure Tunneling notify topic in order to receive the destination token. The example policy below demonstrates the minimum permissions required to run the Secure Tunneling feature. Simply replace the <code>&lt;region&gt;</code> and <code>&lt;accountId</code>&gt; with the correct values. </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;Version&quot;: &quot;2012-10-17&quot;,</div>
<div class="line">  &quot;Statement&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;Effect&quot;: &quot;Allow&quot;,</div>
<div class="line">      &quot;Action&quot;: &quot;iot:Connect&quot;,</div>
<div class="line">      &quot;Resource&quot;: [</div>
<div class="line">      &quot;arn:aws:iot:&lt;region&gt;:&lt;accountId&gt;:client/${iot:Connection.Thing.ThingName}&quot;</div>
<div class="line">      ]</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      &quot;Effect&quot;: &quot;Allow&quot;,</div>
<div class="line">      &quot;Action&quot;: &quot;iot:Subscribe&quot;,</div>
<div class="line">      &quot;Resource&quot;: [</div>
<div class="line">      &quot;arn:aws:iot:&lt;region&gt;:&lt;accountId&gt;:topicfilter/$aws/things/${iot:Connection.Thing.ThingName}/tunnels/notify&quot;</div>
<div class="line">      ]</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">      &quot;Effect&quot;: &quot;Allow&quot;,</div>
<div class="line">      &quot;Action&quot;: &quot;iot:Receive&quot;,</div>
<div class="line">      &quot;Resource&quot;: [</div>
<div class="line">      &quot;arn:aws:iot:&lt;region&gt;:&lt;accountId&gt;:topic/$aws/things/${iot:Connection.Thing.ThingName}/tunnels/notify&quot;</div>
<div class="line">      ]</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md81"></a>
Limitation</h2>
<p>The Secure Tunneling feature within the AWS IoT Device Client currently does not support <a href="https://docs.aws.amazon.com/iot/latest/developerguide/multiplexing.html">multiplex data streams</a>. However the feature supports multiple tunnels each with a single data streams.</p>
<p><a href="#"><em>Back To The Top</em></a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
